(()=>{"use strict";var e,t={922:(e,t,i)=>{var s=i(61);const r=i(771),o=i(554),a=i(700),n=i(189),h=i(358),c=i(810),l=i(829),p=i(993),d=i(780),g={playerBlank:new s.cXo(r),playerDetails:new s.cXo(o),corpse:new s.cXo(a),numbers:new s.cXo(n),edgeTile:new s.cXo(h),background:new s.cXo(c),title:new s.cXo(l),instructions:new s.cXo(p),music:new s.$uU(d)},m=s.V6q.fromImageSource({image:g.playerBlank,grid:{rows:5,columns:3,spriteWidth:24,spriteHeight:20}}),u=s.V6q.fromImageSource({image:g.playerDetails,grid:{rows:5,columns:3,spriteWidth:24,spriteHeight:20}}),w=g.corpse.toSprite(),f=s.V6q.fromImageSource({image:g.numbers,grid:{rows:10,columns:1,spriteWidth:24,spriteHeight:20}}),b=g.edgeTile.toSprite(),v=g.background.toSprite(),y=g.title.toSprite(),S=g.instructions.toSprite(),I=new s.Zxw({size:30,unit:s.Z$d.Px,family:"sans-serif",style:s.Hdx.Normal,bold:!0,textAlign:s.PHM.Center,baseAlign:s._H9.Alphabetic,direction:s.Nmp.LeftToRight,color:s.Ilk.White,smoothing:!1,shadow:{blur:2,offset:s.Bhw(2,2),color:s.Ilk.Black}}),x=new s.Zxw({size:30,unit:s.Z$d.Px,family:"sans-serif",style:s.Hdx.Normal,bold:!0,textAlign:s.PHM.Left,baseAlign:s._H9.Alphabetic,direction:s.Nmp.LeftToRight,color:s.Ilk.White,smoothing:!1,shadow:{blur:2,offset:s.Bhw(2,2),color:s.Ilk.Black}}),B=new s.Zxw({size:18,unit:s.Z$d.Px,family:"sans-serif",style:s.Hdx.Normal,bold:!1,textAlign:s.PHM.Left,baseAlign:s._H9.Alphabetic,direction:s.Nmp.LeftToRight,color:s.Ilk.White,smoothing:!1,shadow:{blur:2,offset:s.Bhw(2,2),color:s.Ilk.Black}}),k=new s.aNw;for(const e in g)k.addResource(g[e]);const O=(e,t)=>t.some((t=>e.input.keyboard.isHeld(t))),z=(e,t=50)=>Math.floor(e/t),C=(e,t=50)=>t*z(e,t)+t/2,A=e=>e.currentScene.world.entityManager.entities.filter((e=>"corpse"==e.name)),M=(e,t,i)=>A(e).some((e=>e.pos.distance(s.Bhw(t,i))<25)),H=(e,t,i)=>new Array(e).fill(i).map((()=>new Array(t).fill(i))),T=(e,t,i)=>Math.min(Math.max(e,t),i),E=e=>e.hsla[0];class W extends s.vtX{isMoving=!1;age;hsla;constructor(e,t,i,r,o){super({x:C(t,50),y:C(i,50),name:"corpse",color:s.Ilk.fromHSL(r[0],r[1],r[2],r[3]),z:-1,width:50,height:50,collisionType:s.v2G.Active}),this.age=o,this.hsla=r}onInitialize(){let e=w.clone();e.tint=this.color;let t=f.getSprite(0,Math.min(9,Math.floor(this.age)));const i=new s.TVh({members:[{graphic:e,pos:s.Bhw(0,4)},{graphic:t,pos:s.Bhw(-1,4)}]});i.scale=s.Bhw(3.125,3.125),this.graphics.add("idle",i),this.graphics.use("idle")}update(e,t){this.isMoving||(this.pos.x=C(this.pos.x,50),this.pos.y=C(this.pos.y,50))}getPoints(){return Math.max(1,10-Math.floor(this.age))}die(e){let t=new s.Vol({pos:this.pos.sub(s.Bhw(this.width,this.width).scale(.5)),width:this.width,height:this.height,emitterType:s.wAz.Rectangle,radius:0,minVel:200,maxVel:150,minAngle:0,maxAngle:6.2,isEmitting:!0,emitRate:500,opacity:1,fadeFlag:!0,particleLife:2e3,maxSize:5,minSize:1,startSize:0,endSize:0,acceleration:new s.OWs(0,500),beginColor:this.color,endColor:s.Ilk.Transparent,random:new s.kky(this.id)}),i=this.graphics.graphics.idle.members[1].graphic.clone();i.scale=s.Bhw(3.125,3.125);let r=new s.vtX({pos:this.pos});r.on("initialize",(e=>{r.graphics.add("idle",i),r.graphics.use("idle")})),e.add(r),(async e=>{const t=new s.rqv(e,(e=>{e.easeBy(s.Bhw(0,-100),1e3)})),i=new s.rqv(e,(e=>{e.fade(0,1e3)})),r=new s._0G([t,i]);e.actions.runAction(r),await e.actions.toPromise()})(r),e.add(t),setTimeout((()=>{t.isEmitting=!1}),100),setTimeout((()=>{t.kill(),r.kill()}),1e3),this.kill()}}const L=()=>{const e=[170,170,170];return e[s.iaL(0,2)]=255,new s.Ilk(e[0],e[1],e[2],e[3])};class K extends s.vtX{speed=300;age=0;tileSize=50;boardHW=5;scaleVector=s.Bhw(this.tileSize/16,this.tileSize/16);timeoutID;direction=s.OWs.Zero;hue=(e=>e[Math.floor(e.length*Math.random())])([0,.08,.2,.5,.65,.95]);movingCorpse=void 0;constructor(e){super({x:e.drawWidth/2,y:e.drawHeight/2,z:-2,name:"player",color:L(),collider:new s.YVA({points:[s.Bhw(-25,-31),s.Bhw(-25,19),s.Bhw(25,19),s.Bhw(25,-31)]}),collisionType:s.v2G.Active});let t=!1;for(;!t;){let i=this.tileSize*(s.iaL(0,this.boardHW-1)+.5),r=this.tileSize*(s.iaL(0,this.boardHW-1)+.5);if(i=C(i,this.tileSize),r=C(r,this.tileSize),this.pos.x=i,this.pos.y=r,M(e,i,r)||(t=!0),A(e).length>=this.boardHW*this.boardHW)throw new Error("No room to create player")}}onInitialize(e){for(let e=0;e<10;e++){let t=Math.floor(e/2),i=f.getSprite(0,e),r=m.getSprite(0,t);r.tint=s.Ilk.fromHSL(this.hue,1,.5+this.age/50,1);let o=u.getSprite(0,t);const a=new s.TVh({members:[{graphic:r,pos:s.Bhw(0,0)},{graphic:o,pos:s.Bhw(0,0)},{graphic:i,pos:s.Bhw(0,0)}]});a.scale=this.scaleVector,this.graphics.add(`idle${e}`,a);let n=s.fwF.fromSpriteSheet(m,[3*t+1,3*t+2],90);n.tint=s.Ilk.fromHSL(this.hue,1,.5+this.age/50,1);let h=s.fwF.fromSpriteSheet(u,[3*t+1,3*t+2],90);const c=new s.TVh({members:[{graphic:n,pos:s.Bhw(0,0)},{graphic:h,pos:s.Bhw(0,0)},{graphic:i,pos:s.Bhw(0,0)}]});c.scale=this.scaleVector,this.graphics.add(`walking${e}`,c)}this.graphics.use("idle0"),this.timeoutID=setInterval((()=>{this.age+=.1,this.age>=10&&this.die(e),Object.keys(this.graphics.graphics).forEach(((e,t)=>{this.graphics.graphics[e].members[0].graphic.tint=s.Ilk.fromHSL(this.hue,1-this.age/20,.5,1)}))}),100)}async die(e){clearTimeout(this.timeoutID),this.movingCorpse&&(this.movingCorpse.isMoving=!1),e.add(new W(e,this.pos.x,this.pos.y,[this.hue,1-this.age/20,.5,1],this.age)),this.kill(),setTimeout((()=>{A(e).length<this.boardHW*this.boardHW&&e.add(new K(e))}),100)}getCorpseInFrontOfPlayer(e){for(let t of A(e))if(this.pos.add(this.direction.scale(this.tileSize)).distance(t.pos)<this.tileSize/2)return t}update(e,t){this.vel.x=0,this.vel.y=0,O(e,[s.IIB.Keys.W,s.IIB.Keys.Up])&&(this.vel.y=-1,this.direction=s.OWs.Up),O(e,[s.IIB.Keys.A,s.IIB.Keys.Left])&&(this.vel.x=-1,this.direction=s.OWs.Left),O(e,[s.IIB.Keys.S,s.IIB.Keys.Down])&&(this.vel.y=1,this.direction=s.OWs.Down),O(e,[s.IIB.Keys.D,s.IIB.Keys.Right])&&(this.vel.x=1,this.direction=s.OWs.Right),O(e,[s.IIB.Keys.K])&&this.age>.1&&this.die(e),0!=this.vel.size?(this.vel=this.vel.normalize().scale(this.speed),this.graphics.use(`walking${Math.min(9,Math.floor(this.age))}`)):(this.graphics.use(`idle${Math.min(9,Math.floor(this.age))}`),this.direction=s.OWs.Zero),O(e,[s.IIB.Keys.Space])&&void 0===this.movingCorpse&&(this.movingCorpse=this.getCorpseInFrontOfPlayer(e),void 0!==this.movingCorpse&&(this.movingCorpse.isMoving=!0,this.movingCorpse.actions.follow(this))),e.input.keyboard.wasReleased(s.IIB.Keys.Space)&&void 0!==this.movingCorpse&&(this.movingCorpse.isMoving=!1,this.movingCorpse.actions.clearActions(),this.movingCorpse=void 0)}}const V=(e,t,i,r=s.Ilk.Transparent)=>new s.vtX({name:"brick",x:e*i-i/2,y:t*i-i/2,width:i,height:i,color:r});class X extends s.D4V{width=5;height=5;state="menu";score=0;menuCenter=s.Bhw(-100,0);backgroundStage;cameraActor;gameOverLabel;constructor(){super({displayMode:s.d1Y.FitScreen,backgroundColor:s.Ilk.fromHex("#3ab643")})}start(){let e=new s.__J({text:`SCORE: ${this.score}`,pos:s.Bhw(-50,-30),font:x,name:"score",z:10});P.add(e);const t=new s.vtX({pos:this.menuCenter.sub(s.Bhw(0,200)),z:100});y.scale=s.Bhw(2,2),t.graphics.add(y),this.add(t);const i=new s.vtX({pos:this.menuCenter.sub(s.Bhw(180,0)),z:100});i.graphics.add(S),this.add(i);const r=new s.__J({text:"10HEADS are small short lived creatures.\n(THEY ONLY LIVE for 10 SECONDS!)\nStack 5 of them up to remove them and claim   \ntheir score. The bigger the stack the higher\nthe combo multiplier.",pos:this.menuCenter.add(s.Bhw(-370,100)),font:B,z:100});return this.add(r),this.backgroundStage=((e,t,i)=>{const r=50,o=[],a=(t+=2)*r+0*t,n=(i+=2)*r+0*i;let h=s.Bhw(3.125,3.125),c=b.clone();c.scale=h;let l=b.clone();l.origin=s.Bhw(10,10),l.rotation=s.M5Z/2,l.scale=h;let p=b.clone();p.origin=s.Bhw(10,10),p.rotation=-s.M5Z/4,p.scale=h;let d=b.clone();d.origin=s.Bhw(10,10),d.rotation=s.M5Z/4,d.scale=h;for(let e=1;e<i-1;e++){let i=V(0,e,r);i.graphics.add(p);let s=V(t-1,e,r);s.graphics.add(d),o.push(i,s)}for(let e=1;e<i-1;e++){let t=V(e,0,r);t.graphics.add(c);let s=V(e,i-1,r);s.graphics.add(l),o.push(t,s)}const g=s.Ilk.fromHex("#3ab643");[[0,0],[0,i-1],[t-1,0],[t-1,i-1]].forEach((([e,t])=>{let i=V(e,t,r,g);o.push(i)})),o.forEach((t=>{t.body.collisionType=s.v2G.Fixed,e.add(t)}));const m=new s.vtX({name:"stage",width:a,height:n,x:a/2-r,y:n/2-r,z:-10});return v.scale=h,m.graphics.add(v),e.add(m),m})(this,this.width,this.height),this.cameraActor=new s.vtX({x:this.drawWidth/2,y:this.drawHeight/2}),P.add(this.cameraActor),this.gameOverLabel=new s.__J({text:"GAME OVER",pos:this.backgroundStage.pos,font:I,z:100}),super.start(k)}}const P=new X;P.start().then((()=>{P.currentScene.camera.strategy.lockToActor(P.cameraActor),P.cameraActor.pos=P.menuCenter,P.currentScene.camera.zoom=.5,P.currentScene.camera.zoomOverTime(1,1e3,s.q8b.EaseOutCubic),(async()=>{for(;;)await g.music.play(.5)})()})),setInterval((()=>{if(console.log(P.state),"running"!=P.state){if("gameover"==P.state){if(O(P,[s.IIB.Keys.Enter,s.IIB.Keys.Space]))return P.cameraActor.actions.easeTo(P.menuCenter,1e3,s.q8b.EaseOutCubic),P.currentScene.camera.zoomOverTime(1,1e3,s.q8b.EaseOutCubic),P.remove(P.gameOverLabel),void(P.state="menu")}else if("menu"==P.state&&O(P,[s.IIB.Keys.Enter,s.IIB.Keys.Space]))return P.cameraActor.actions.easeTo(P.backgroundStage.pos,1e3,s.q8b.EaseOutCubic),P.currentScene.camera.zoomOverTime(1.6,1e3,s.q8b.EaseOutCubic),A(P).forEach((e=>e.die(P))),P.score=0,setTimeout((()=>{const e=new K(P);P.add(e)}),100),void(P.state="running");return}const e=A(P);let t=((e,t=3)=>{let i=e.length,s=e[0].length,r=H(i,s,!1),o=[];for(let a=0;a<i;a++)for(let n=0;n<s;n++){if(r[a][n])continue;let h=e[a][n];if(void 0===h){r[a][n]=!0;continue}let c=E(h),l=[],p=[];l.push([a,n]);let d=H(i,s,!1);for(;l.length>0;){let[t,o]=l.shift(),a=e[t][o];d[t][o]=!0,E(a)==c&&(r[t][o]=!0,p.push(a),[[T(t+1,0,i-1),o],[T(t-1,0,i-1),o],[t,T(o+1,0,s-1)],[t,T(o-1,0,s-1)]].forEach((([t,i])=>{!d[t][i]&&e[t][i]&&l.push([t,i])})))}p.length>=t&&o.push(p)}return o})(((e,t,i,s=50)=>{let r=H(i,t,void 0);for(let t of e)if(!t.isMoving){let e=z(t.pos.x,s),i=z(t.pos.y,s);r[e][i]=t}return r})(e,P.width,P.height),5),i=0;var r,o;t.forEach((e=>{e.forEach((e=>{i+=e.getPoints(),e.die(P)}));let t=Math.max(1,e.length-4);P.score+=i*t})),r=P,o=P.score,r.currentScene.world.entityManager.entities.find((e=>"score"==e.name)).text=`SCORE: ${o}`,t.length>0||e.length==P.width*P.height&&(P.add(P.gameOverLabel),P.state="gameover")}),100)},810:(e,t,i)=>{e.exports=i.p+"6d20541cb310c78bc52a.png"},700:(e,t,i)=>{e.exports=i.p+"a5b865d8bf03be50e405.png"},358:(e,t,i)=>{e.exports=i.p+"3a99802cae75973f14c6.png"},993:(e,t,i)=>{e.exports=i.p+"3a1eee85a8f57eaa0bfc.png"},829:(e,t,i)=>{e.exports=i.p+"f036acc720d958a04afa.png"},780:(e,t,i)=>{e.exports=i.p+"60beadaf932892e52bac.wav"},189:(e,t,i)=>{e.exports=i.p+"aca3c380ff40b01e2736.png"},554:(e,t,i)=>{e.exports=i.p+"d080f487eb728592e12c.png"},771:(e,t,i)=>{e.exports=i.p+"3225ac42f364cf30fdb3.png"}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,s),o.exports}s.m=t,e=[],s.O=(t,i,r,o)=>{if(!i){var a=1/0;for(l=0;l<e.length;l++){for(var[i,r,o]=e[l],n=!0,h=0;h<i.length;h++)(!1&o||a>=o)&&Object.keys(s.O).every((e=>s.O[e](i[h])))?i.splice(h--,1):(n=!1,o<a&&(a=o));if(n){e.splice(l--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[i,r,o]},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,o,[a,n,h]=i,c=0;if(a.some((t=>0!==e[t]))){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);if(h)var l=h(s)}for(t&&t(i);c<a.length;c++)o=a[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(l)},i=self.webpackChunkexcalibur_webpack=self.webpackChunkexcalibur_webpack||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var r=s.O(void 0,[61],(()=>s(922)));r=s.O(r)})();
//# sourceMappingURL=main.js.map